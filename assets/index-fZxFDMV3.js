import{r as e,j as s,aD as t,aE as a,c as r,Y as l,d as i,a as x,u as c,x as n,b as m,f as d,C as o,e as p,aF as u,aG as b,J as f,g as h,L as j,af as N,E as g,B as w,D as v,q as S,s as y,w as C,h as k,i as D}from"./index-B22ef-ay.js";import{m as E,a as L}from"./modeal1-Bec6m7_0.js";import{B as _}from"./back-uMgoa6Bo.js";import{B as F}from"./BonusTemplate-t2UEHmde.js";import{U as B}from"./USDTToken-sPSJkXxs.js";import{p as I}from"./parseEther-BEx39YpX.js";import{g as M}from"./getBlock-_s9P1heS.js";var T="Progress",[z,P]=t(T),[U,O]=z(T),q=e.forwardRef(((e,t)=>{const{__scopeProgress:r,value:l=null,max:i,getValueLabel:x=R,...c}=e;(i||0===i)&&G(i);const n=G(i)?i:100;null!==l&&K(l,n);const m=K(l,n)?l:null,d=X(m)?x(m,n):void 0;return s.jsx(U,{scope:r,value:m,max:n,children:s.jsx(a.div,{"aria-valuemax":n,"aria-valuemin":0,"aria-valuenow":X(m)?m:void 0,"aria-valuetext":d,role:"progressbar","data-state":J(m,n),"data-value":null!=m?m:void 0,"data-max":n,...c,ref:t})})}));q.displayName=T;var A="ProgressIndicator",Z=e.forwardRef(((e,t)=>{var r;const{__scopeProgress:l,...i}=e,x=O(A,l);return s.jsx(a.div,{"data-state":J(x.value,x.max),"data-value":null!=(r=x.value)?r:void 0,"data-max":x.max,...i,ref:t})}));function R(e,s){return"".concat(Math.round(e/s*100),"%")}function J(e,s){return null==e?"indeterminate":e===s?"complete":"loading"}function X(e){return"number"==typeof e}function G(e){return X(e)&&!isNaN(e)&&e>0}function K(e,s){return X(e)&&!isNaN(e)&&e<=s&&e>=0}Z.displayName=A;var V=q,W=Z;function Y(e){const t=r.c(12);let a,i,x,c;t[0]!==e?(({className:a,value:x,...i}=e),t[0]=e,t[1]=a,t[2]=i,t[3]=x):(a=t[1],i=t[2],x=t[3]),t[4]!==a?(c=l("relative h-2 w-full overflow-hidden rounded-full border border-[#70C77F] bg-zinc-900/20 dark:bg-zinc-50/20",a),t[4]=a,t[5]=c):c=t[5];const n="translateX(-".concat(100-(x||0),"%)");let m,d;return t[6]!==n?(m=s.jsx(W,{"data-slot":"progress-indicator",className:"bg-custom-gradient h-full w-full flex-1 rounded-full transition-all dark:bg-zinc-50",style:{transform:n}}),t[6]=n,t[7]=m):m=t[7],t[8]!==i||t[9]!==c||t[10]!==m?(d=s.jsx(V,{"data-slot":"progress",className:c,...i,children:m}),t[8]=i,t[9]=c,t[10]=m,t[11]=d):d=t[11],d}function H(){const{tokenList:t,refetch:a}=i(),{toast:r}=x(),{t:T,i18n:z}=c(),P=n(),U=m(),[O,q]=e.useState(!1),[A,Z]=e.useState(!1),[R,J]=e.useState(!1),[X,G]=e.useState(!0),[K,V]=e.useState(!0),[W,H]=e.useState(!1),[Q,$]=e.useState(0),[ee,se]=e.useState(!0),te=d(),{address:ae}=o(),{role:re,updateRole:le}=p(),ie=[1,2],[xe,ce]=e.useState(0),[ne,me]=e.useState({price:0,power:0,sold:0,max:0}),[de,oe]=e.useState({price:0,power:0,sold:0,max:0}),[pe,ue]=e.useState({hours:0,minutes:0,seconds:0}),[be,fe]=e.useState(!1);e.useEffect((()=>{be&&he()}),[re,ae,te,t,be]);e.useEffect((()=>{let e,s=!0;const t=async()=>{try{const e=1747728e3-await(async()=>{const e=(await M(h)).timestamp;return Number(e)})();return e<=0?(s&&(fe(!0),await he(),ue({hours:0,minutes:0,seconds:0})),!0):(s&&ue({hours:Math.floor(e%86400/3600),minutes:Math.floor(e%3600/60),seconds:Math.floor(e%60)}),!1)}catch(e){return!1}};return(async()=>{await t()||(e=setInterval((async()=>{await t()&&clearInterval(e)}),1e3))})(),()=>{s=!1,clearInterval(e)}}),[]);const he=async()=>{try{if(se(!0),ae){const e=await je(Number(re.tokenSubscript));H(e);const s=u(b([{name:"medalType",type:"uint8"},{name:"cardId",type:"uint256"}],[ie[0],BigInt(re.tokenId)])),a=u(b([{name:"medalType",type:"uint8"},{name:"cardId",type:"uint256"}],[ie[1],BigInt(re.tokenId)])),[r,l,i,x,c]=await f(h,{contracts:[{abi:F.abi,address:t[re.tokenSubscript].bonus,functionName:"configOf",args:[ie[0]]},{abi:F.abi,address:t[re.tokenSubscript].bonus,functionName:"configOf",args:[ie[1]]},{abi:F.abi,address:t[re.tokenSubscript].bonus,functionName:"isBuied",args:[s]},{abi:F.abi,address:t[re.tokenSubscript].bonus,functionName:"isBuied",args:[a]},{abi:B.abi,address:B.networks[te].address,functionName:"balanceOf",args:[ae]}]});r.error||l.error||(me({price:Number(r.result[0]),power:Number(r.result[1]),max:Number(r.result[2]),sold:Number(r.result[3])}),oe({price:Number(l.result[0]),power:Number(l.result[1]),max:Number(l.result[2]),sold:Number(l.result[3])})),i.error||x.error||(G(i.result),V(x.result)),c.error||$(Number(j(c.result)))}}finally{se(!1)}},je=async e=>{const s=async s=>await S(h,{abi:F.abi,address:t[e].bonus,functionName:"configOf",args:[s]}),[a,r]=await Promise.all([s(1),s(2)]);return a[2]+a[3]==BigInt("0")&&r[2]+r[3]==BigInt("0")},Ne=async e=>{try{if(e){const{request:s}=await y(h,{abi:B.abi,address:B.networks[te].address,functionName:"approve",args:[t[re.tokenSubscript].bonus,I("10000000000000")]}),a=await C(h,s);await k(h,{hash:a}),ge(e)}}catch(s){e==ie[1]?q(!1):Z(!1)}},ge=async e=>{try{e==ie[1]?q(!0):Z(!0);const{result:s,request:l}=await y(h,{abi:F.abi,address:t[re.tokenSubscript].bonus,functionName:"buyMedal",args:[e,BigInt(re.tokenId)]}),i=await C(h,l);await k(h,{hash:i});const x=await k(h,{hash:i});await D(U,x.blockNumber),he(),e==ie[1]?(q(!1),V(!0)):(Z(!1),G(!0)),r(T("Subscribe.text1")),J(!1),a()}catch(s){e==ie[1]?q(!1):Z(!1);const t=s.stack,a=t.match(/transaction:\s+(.+)/),l=t.match(/MetaMask Tx Signature:\s+(.+)/);if(l&&"User denied transaction signature."==l[1])return r(T("Subscribe.text2"));if(!a)return r(T("Subscribe.text2"));if("revert Invalid childrenCount"===a[1]||"Invalid card owner"===a[1]||"Invalid MedalType"===a[1])return r(T("Subscribe.text16"))}},we=async e=>{(async e=>{if(ae){if(e==ie[1]?q(!0):Z(!0),e==ie[1]){if(Q<de.price)return q(!1),void r(T("Subscribe.text15"))}else if(Q<ne.price)return Z(!1),void r(T("Subscribe.text15"));const s=await S(h,{abi:B.abi,address:B.networks[te].address,functionName:"allowance",args:[ae,t[re.tokenSubscript].bonus]}),a=1==e?ne.price:de.price;Number(j(s))>a?ge(e):Ne(e)}})(e)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"fixed z-10 grid w-full grid-cols-3 bg-white p-[17px_16px] sm:hidden",children:[s.jsx("div",{className:"flex items-center pl-2",onClick:()=>P(-1),children:s.jsx("img",{src:_,alt:"back",className:"w-4"})}),s.jsx("div",{className:"text-center text-[16px] text-[#333333]",children:T("Subscribe.text3")})]}),s.jsxs("div",{className:l("bg-white p-[10px_16px_20px] sm:m-[0_auto] sm:flex sm:w-[1100px] sm:flex-col sm:pt-[78px]","en"==z.language&&"pt-[55px]"),children:[s.jsxs("div",{className:"mt-[80px]",children:[s.jsx("img",{src:"/assets/modeallogo-DcNBIJKq.png",className:"w-full sm:hidden",alt:""}),s.jsx("img",{src:"/assets/pcmodeallogo-yTXawE8n.png",className:"hidden w-full sm:flex",alt:""})]}),s.jsx("div",{className:"my-[20px] hidden text-[16px] font-medium text-[#3D3D3D] sm:flex sm:text-[20px]",children:T("Subscribe.text3")}),s.jsxs("div",{className:"flex flex-col sm:mx-auto sm:grid sm:grid-cols-2",children:[s.jsxs("div",{className:"order-2 border-t border-[#F0F0F0] pt-[20px] sm:order-2 sm:ml-[40px] sm:border-l sm:border-t-0 sm:py-0 sm:pl-[50px]",children:[s.jsx("h4",{className:"sm mb-2 mt-3 font-bold text-[#333333] sm:text-[18px]",children:T("Subscribe.text30")}),s.jsxs("div",{className:"relative sm:flex sm:items-center",children:[s.jsxs("div",{children:[s.jsxs("div",{children:[s.jsx("h3",{className:"mb-2 font-bold text-[#333333] sm:text-[16px] sm:font-medium",children:T("Subscribe.text23")}),s.jsxs("ol",{className:"list-decimal space-y-1 pl-5 text-sm text-[#797979] sm:space-y-3 sm:text-[14px]",children:[s.jsx("li",{children:T("Subscribe.text24")}),s.jsx("li",{children:T("Subscribe.text24_1")})]})]}),s.jsx("h3",{className:"mb-2 font-bold text-[#333333] sm:text-[16px] sm:font-medium",children:T("Subscribe.text25")}),s.jsx("div",{className:"relative flex sm:mb-0",children:s.jsxs("ol",{className:"list-decimal space-y-1 pl-5 text-sm text-[#797979] sm:space-y-3 sm:text-[14px]",children:[s.jsx("li",{children:T("Subscribe.text26")}),s.jsx("li",{children:T("Subscribe.text27")}),s.jsx("li",{children:T("Subscribe.text28")})]})})]}),s.jsx("img",{src:"/assets/modealimg-CZPp6gsa.png",className:"absolute right-0 top-0 sm:h-[237px] sm:w-[234px]",alt:""})]}),s.jsxs("div",{className:"mb-[190px] mt-2 sm:mb-0",children:[s.jsx("h3",{className:"mb-2 font-bold text-[#333333] sm:text-[16px] sm:font-medium",children:T("Subscribe.text31")}),s.jsxs("ol",{className:"list-decimal space-y-1 pl-5 text-sm text-[#797979] sm:space-y-3 sm:text-[14px]",children:[s.jsx("li",{children:T("Subscribe.text32")}),s.jsx("li",{children:T("Subscribe.text33")}),s.jsx("li",{children:T("Subscribe.text34")})]})]})]}),s.jsxs("div",{className:"order-1 sm:order-1 sm:flex sm:flex-col",children:[s.jsx("div",{className:"my-[20px] text-[16px] font-medium text-[#3D3D3D] sm:hidden sm:text-[20px]",children:T("Subscribe.text3")}),ee?s.jsxs("div",{className:"mt-[30%] flex flex-col items-center justify-center text-gray-500",children:[s.jsx(N,{className:"mb-5 animate-spin",size:60,color:"#6b7280"}),T("Loading...")]}):W?s.jsx(g,{text:T("Subscribe.text35"),imageWidth:97.5,divclassName:"py-[30px] sm:pt-[20%]",className:"pt-1 text-center text-[#8A8A8A] sm:pt-[10px]"}):s.jsxs(s.Fragment,{children:[ne.max>0&&s.jsxs("div",{className:"mb-6 flex justify-between rounded-lg border border-[#E4E7EC] bg-white p-[18px_19px] sm:mb-[12px] sm:justify-start sm:p-[27px_32px]",children:[s.jsx("img",{src:E,alt:"modealimg1",className:"h-[120px] w-[120px] sm:w-[127px]"}),s.jsxs("div",{className:"ml-[15px] w-full sm:ml-[20px]",children:[s.jsxs("div",{className:l("en"==z.language?"flex flex-col items-baseline sm:flex-row":"flex items-center"),children:[s.jsx("span",{className:"text-center text-[16px] font-medium text-[#333333] sm:text-[16px]",children:T("Subscribe.text12")}),s.jsx("div",{className:l("rounded-[3px] bg-[#EEEEEE] p-[2px_3px] text-center text-[12px] text-[#3D3D3D] sm:text-[12px]","en"!=z.language&&"ml-[9px]"),children:T("Subscribe.text10",{max:ne.max})})]}),s.jsxs("div",{className:"text-[12px] text-[#3D3D3D]",children:[s.jsxs("span",{children:[T("Subscribe.text13"),":"]}),s.jsx("span",{className:"text-[#2C2C2C]",children:ne.power})]}),s.jsxs("div",{className:"mb-[3px] mt-[10px] flex items-center justify-between text-[12px] text-[#4B5563] sm:text-[22px]",children:[s.jsxs("div",{className:"flex items-center text-[12px]",children:[s.jsxs("span",{className:"text-[#797979]",children:[" ",T("Subscribe.text18")," "]}),s.jsxs("span",{className:"text-[#2C2C2C]",children:[" ",ne.sold," "]})]}),s.jsxs("div",{className:"flex items-center text-[12px]",children:[s.jsxs("span",{className:"text-[#797979]",children:[" ",T("Subscribe.text19")," "]}),s.jsxs("span",{className:"text-[#2C2C2C]",children:[ne.max-ne.sold," "]})]})]}),s.jsx(Y,{value:ne.sold/ne.max*100,className:"w-full bg-[#F3F4F6] sm:w-[320px]"}),s.jsxs("div",{className:"mt-[12px] flex justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"text-[18px]/6 font-black text-black sm:text-[18px]",children:ne.price}),s.jsxs("span",{className:"text-[12px] text-[#3D3D3D]",children:[" ","U"]})]}),s.jsx(w,{onClick:()=>{J(!0),ce(1)},isLoading:A,disabled:X||ne.max==ne.sold,type:"green",className:l("flex justify-center p-[8px_24px] text-[16px] sm:p-[8px_24px] sm:text-[14px]","en"==z.language&&"px-[10px]"),children:ne.max==ne.sold?T("Subscribe.text41"):T(X?"Subscribe.text17":"Subscribe.text14")})]})]})]}),de.max>0&&s.jsxs("div",{className:"mb-6 flex rounded-lg border border-[#E4E7EC] bg-white p-[18px_19px] sm:mb-0 sm:justify-start sm:p-[27px_32px]",children:[s.jsx("img",{src:L,alt:"modealimg1",className:"h-[130px] w-[127px] sm:w-[127px]"}),s.jsxs("div",{className:"ml-[15px] w-full sm:ml-[20px]",children:[s.jsxs("div",{className:l("en"==z.language?"flex flex-col items-baseline sm:flex-row":"flex items-center"),children:[s.jsx("span",{className:"text-center text-[16px] font-medium text-[#333333] sm:text-[16px]",children:T("Subscribe.text9")}),s.jsx("div",{className:l("rounded-[3px] bg-[#EEEEEE] p-[2px_3px] text-center text-[12px] text-[#3D3D3D] sm:text-[12px]","en"!=z.language&&"ml-[9px]"),children:T("Subscribe.text10",{max:de.max})})]}),s.jsxs("div",{className:"text-[12px] text-[#3D3D3D]",children:[s.jsxs("span",{children:[T("Subscribe.text13"),":"]}),s.jsx("span",{className:"text-[#2C2C2C]",children:de.power})]}),s.jsxs("div",{className:"mb-[3px] mt-[10px] flex items-center justify-between text-[12px] text-[#4B5563] sm:text-[22px]",children:[s.jsxs("div",{className:"flex items-center text-[12px]",children:[s.jsxs("span",{className:"text-[#797979]",children:[" ",T("Subscribe.text18")," "]}),s.jsxs("span",{className:"text-[#2C2C2C]",children:[" ",de.sold," "]})]}),s.jsxs("div",{className:"flex items-center text-[12px]",children:[s.jsxs("span",{className:"text-[#797979]",children:[" ",T("Subscribe.text19")," "]}),s.jsxs("span",{className:"text-[#2C2C2C]",children:[de.max-de.sold," "]})]})]}),s.jsx(Y,{value:de.sold/de.max*100,className:"w-full bg-[#F3F4F6] sm:w-[320px]"}),s.jsxs("div",{className:"mt-[12px] flex justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"text-[18px]/6 font-black text-black sm:text-[18px]",children:de.price}),s.jsxs("span",{className:"text-[12px] text-[#3D3D3D]",children:[" ","U"]})]}),s.jsx(w,{onClick:()=>{J(!0),ce(2)},isLoading:O,disabled:K||de.max==de.sold,type:"green",className:l("flex justify-center p-[8px_24px] text-[16px] sm:p-[8px_24px] sm:text-[14px]","en"==z.language&&"px-[10px]"),children:de.max==de.sold?T("Subscribe.text41"):T(K?"Subscribe.text17":"Subscribe.text14")})]})]})]})]})]})]})]}),s.jsxs(v,{open:R,onOpenChange:()=>J(!1),className:"px-5 py-4",children:[s.jsx("img",{src:"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20fill='none'%20version='1.1'%20width='56'%20height='56'%20viewBox='0%200%2056%2056'%3e%3cg%3e%3crect%20x='4'%20y='4'%20width='48'%20height='48'%20rx='24'%20fill='%23FEEFC7'%20fill-opacity='1'/%3e%3crect%20x='4'%20y='4'%20width='48'%20height='48'%20rx='24'%20fill-opacity='0'%20stroke-opacity='1'%20stroke='%23FFFAEB'%20fill='none'%20stroke-width='8'/%3e%3cg%3e%3cpath%20d='M28,38.5C21.93366,38.5,17,33.5663,17,27.5C17,21.43366,21.93366,16.5,28,16.5L28,18.01843C22.7715,18.01843,18.51843,22.2715,18.51843,27.5C18.51843,32.7285,22.7715,36.9816,28,36.9816C33.2285,36.9816,37.4816,32.7285,37.4816,27.5L39,27.5C39,33.5663,34.063900000000004,38.5,28,38.5ZM32.4988,28.888199999999998L26.42998,28.888199999999998L26.42998,22.81941L27.9459,22.81941L27.9459,27.369799999999998L32.4988,27.369799999999998L32.4988,28.888199999999998ZM26.91241,27.3322L35.4949,18.74973L36.5686,19.82342L27.9861,28.405900000000003L26.91241,27.3322Z'%20fill='%23DC6803'%20fill-opacity='1'%20style='mix-blend-mode:passthrough'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",alt:""}),s.jsxs("div",{className:"mt-[12px] flex flex-col",children:[s.jsx("span",{className:"text-[18px] text-[#101828]",children:T("Subscribe.text11")}),s.jsx("span",{className:"text-[14px] text-[#475467]",children:T("Subscribe.text21",{price:2==xe?de.price:ne.price})})]}),s.jsxs("div",{className:"mt-[16px] flex items-center space-x-3 rounded-[12px] border border-[#E4E7EC] p-[16px_19px]",children:[s.jsx("img",{src:2==xe?L:E,width:40,alt:"modealimg",className:"rounded-[4px]"}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[14px] text-[#344054]",children:T(2==xe?"Subscribe.text9":"Subscribe.text12")}),s.jsxs("span",{className:"text-[14px] text-[#475467]",children:[T("Subscribe.text20"),"1"]})]})]}),s.jsxs("div",{className:"flex flex-col items-center justify-between sm:flex-row",children:[s.jsx(w,{onClick:()=>J(!1),type:"white",size:"large",className:"order-2 w-full sm:order-1 sm:w-[45%] sm:px-[40px] sm:text-[14px]",children:T("Cancel")}),s.jsx(w,{onClick:()=>{we(xe)},isLoading:2==xe?O:A,type:"green",size:"large",className:"order-1 my-3 w-full sm:order-2 sm:w-[45%] sm:px-[40px] sm:text-[14px]",children:T("newMy.Upgrade4Dialog.text5")})]})]})]})}export{H as default};
